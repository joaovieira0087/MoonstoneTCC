@model List<MoonstoneTCC.Models.ListaJogo>
@{
    ViewData["Title"] = "Minhas Listas";
}

<div class="container mt-4">
    <h2 class="text-light mb-3">
        <i class="fas fa-folder-open text-purple"></i> Minhas Listas de Jogos
    </h2>

    <!-- Criar nova lista -->
    <form asp-action="CriarLista" method="post" class="mb-4">
        <div class="input-group">
            <input type="text" name="nomeLista" class="form-control bg-dark text-white border-purple" placeholder="Nome da nova lista" required />
            <button type="submit" class="btn btn-purple"><i class="fas fa-plus me-1"></i> Criar Lista</button>
        </div>
    </form>

    @if (!Model.Any())
    {
        <p class="text-muted">Você ainda não criou nenhuma lista.</p>
    }
    else
    {
        @foreach (var lista in Model)
        {
            var totalJogos = lista.Jogos?.Count ?? 0;

            <div class="card bg-dark text-white border-purple mb-5 shadow">
                <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-3">
                    <div>
                        <h5 class="mb-0">
                            <i class="fas fa-gamepad text-purple me-2"></i> @lista.Nome
                            <span class="badge bg-purple ms-2">@totalJogos @(totalJogos == 1 ? "jogo" : "jogos")</span>
                        </h5>
                    </div>
                    @if (lista.EPublica)
                    {
                        <span class="badge bg-success ms-2"><i class="fas fa-globe me-1"></i> Pública</span>
                    }
                    else
                    {
                        <span class="badge bg-secondary ms-2"><i class="fas fa-lock me-1"></i> Privada</span>
                    }

                    <div class="d-flex flex-wrap gap-2">
                        <!-- Excluir Lista -->
                        <form asp-controller="ListaJogo" asp-action="ExcluirLista" method="post" onsubmit="return confirmarExclusao('Deseja excluir a lista &quot;@lista.Nome&quot;?', this)">
                            <input type="hidden" name="listaId" value="@lista.ListaJogoId" />
                            <button type="submit" class="btn btn-danger btn-sm"><i class="fas fa-trash-alt me-1"></i> Excluir Lista</button>
                        </form>

                        @if (lista.Jogos?.Any() == true)
                        {
                            <!-- Adicionar ao Carrinho -->
                            <form asp-controller="CarrinhoCompra" asp-action="AdicionarMultiplosAoCarrinho" method="post">
                                @foreach (var item in lista.Jogos)
                                {
                                    <input type="hidden" name="jogoIds" value="@item.JogoId" />
                                }
                                <button type="submit" class="btn btn-purple btn-sm">
                                    <i class="fas fa-cart-plus me-1"></i> Adicionar @lista.Jogos.Count ao Carrinho
                                </button>
                            </form>

                            <!-- Comprar Agora -->
                            <form asp-controller="CarrinhoCompra" asp-action="ComprarMultiplosAgora" method="post">
                                @foreach (var item in lista.Jogos)
                                {
                                    <input type="hidden" name="jogoIds" value="@item.JogoId" />
                                }
                                <button type="submit" class="btn btn-success btn-sm">
                                    <i class="fas fa-bolt me-1"></i>
                                    Comprar @(lista.Jogos.Count == 1 ? " 1 jogo agora" : $"os {lista.Jogos.Count} jogos agora")
                                </button>
                            </form>

                        }

                        <!-- Alternar Público/Privado -->
                        <form asp-controller="ListaJogo" asp-action="AlternarPrivacidade" method="post">
                            <input type="hidden" name="listaId" value="@lista.ListaJogoId" />
                            @if (lista.EPublica)
                            {
                                <button type="submit" class="btn btn-outline-warning btn-sm">
                                    <i class="fas fa-lock-open me-1"></i> Tornar Privada
                                </button>
                            }
                            else
                            {
                                <button type="submit" class="btn btn-outline-info btn-sm">
                                    <i class="fas fa-globe me-1"></i> Tornar Pública
                                </button>
                            }
                        </form>

                    </div>
                </div>

                <div class="card-body">
                    @if (!lista.Jogos.Any())
                    {
                        <p class="text-muted">Nenhum jogo adicionado ainda.</p>
                    }
                    else
                    {
                        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                            @foreach (var item in lista.Jogos)
                            {
                                <div class="col">
                                    <div class="card h-100 custom-card-roxo text-white border border-purple shadow-sm">
                                        <img src="@item.Jogo.ImagemThumbnailUrl" class="card-img-top" alt="@item.Jogo.Nome">
                                        <div class="card-body d-flex flex-column justify-content-between">
                                            <div class="text-start px-2 pt-2">
                                            <h5 class="card-title fw-bold text-white mb-1">@item.Jogo.Nome</h5>

                                            <p class="mb-1">
                                                <span class="text-purple fw-semibold"></span>
                                                <span class="badge bg-dark text-white border border-purple">@item.Jogo.Plataformas</span>
                                            </p>

                                                <!-- Preço (aproximado do botão) -->
                                                <p class="fw-bold text-dark text-center mb-3" style="font-size: 1.1rem;">
                                                    <a asp-controller="Jogo" asp-action="Details" asp-route-jogoId="@item.Jogo.JogoId" class="text-dark text-decoration-none">
                                                        @if (item.Jogo.PrecoPromocional != null && item.Jogo.PorcentagemDesconto != null)
                                                        {
                                                            <span class="text-muted text-decoration-line-through me-2">
                                                                @item.Jogo.Preco.ToString("C")
                                                            </span>
                                                            <span class="text-danger fw-bold">
                                                                @item.Jogo.PrecoPromocional?.ToString("C")
                                                            </span>
                                                            <span class="badge bg-success ms-2">
                                                                -@item.Jogo.PorcentagemDesconto%
                                                            </span>
                                                        }
                                                        else
                                                        {
                                                            <span class="text-dark">@item.Jogo.Preco.ToString("C")</span>
                                                        }
                                                    </a>
                                                </p>
                                        </div>

                                            <div class="mt-3 d-flex justify-content-between align-items-center">
                                                <a class="btn btn-outline-light btn-sm" href="@Url.Action("Details", "Jogo", new { jogoId = item.JogoId })">
                                                    <i class="fas fa-info-circle me-1"></i> Ver Detalhes
                                                </a>
                                                <form asp-controller="ListaJogo" asp-action="RemoverJogoDaLista" method="post" onsubmit="return confirmarExclusao('Remover &quot;@item.Jogo.Nome&quot; da lista &quot;@lista.Nome&quot;?', this)">
                                                    <input type="hidden" name="listaId" value="@lista.ListaJogoId" />
                                                    <input type="hidden" name="jogoId" value="@item.JogoId" />
                                                    <button type="submit" class="btn btn-outline-danger btn-sm">
                                                        <i class="fas fa-times me-1"></i> Remover
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        }
    }
</div>
<div id="confirmModal" class="modal-bg" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="confirmMessage" tabindex="-1">
    <div class="modal-box shadow-lg">
        <div class="modal-header-custom mb-3">
            <i class="fas fa-exclamation-triangle fa-lg text-warning me-2"></i>
            <span class="modal-title text-white fw-bold fs-5">Confirmação Necessária</span>
        </div>
        <p id="confirmMessage" class="text-light mb-4">Tem certeza que deseja continuar com esta ação?</p>
        <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-outline-secondary px-4" onclick="fecharModal()">
                <i class="fas fa-times-circle me-1"></i> Cancelar
            </button>
            <button type="button" class="btn btn-purple px-4" onclick="confirmarAcao()">
                <i class="fas fa-check-circle me-1"></i> Confirmar
            </button>
        </div>
    </div>
</div>


<style>

    .text-purple { color: #9d3ce6; }
    .bg-purple { background-color: #7e00c8; color: #fff; }
    .border-purple { border-color: #7e00c8 !important; }
    .btn-purple {
        background-color: #7e00c8;
        color: white;
        border: none;
    }
    .btn-purple:hover {
        background-color: #9d3ce6;
    }

  .modal-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1050;
}

.modal-box {
    background-color: #212134;
    padding: 28px;
    border: 2px solid #7e00c8;
    border-radius: 14px;
    width: 400px;
    max-width: 90%;
    box-shadow: 0 0 20px rgba(126, 0, 200, 0.6);
    transition: all 0.3s ease;
}

.modal-header-custom {
    display: flex;
    align-items: center;
    border-bottom: 1px solid #9d3ce6;
    padding-bottom: 10px;
}

.modal-title {
    font-size: 1.25rem;
    color: white;
}

.btn-purple {
    background-color: #7e00c8;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 16px;
    transition: background-color 0.3s ease;
}

.btn-purple:hover {
    background-color: #9d3ce6;
}

.btn-outline-secondary {
    background-color: transparent;
    color: #ccc;
    border: 1px solid #999;
    border-radius: 6px;
    transition: all 0.3s ease;
}

.btn-outline-secondary:hover {
    color: white;
    border-color: #bbb;
    background-color: rgba(255,255,255,0.05);
}

.custom-card-roxo {
    background-color: #2b1b3a; /* Roxo escuro fosco */
    transition: background-color 0.3s ease;
}

.custom-card-roxo:hover {
    background-color: #3b2650; /* Um pouco mais claro no hover */
}

.text-purple {
    color: #9d3ce6;
}

.border-purple {
    border-color: #7e00c8 !important;
}



</style>


<div id="notificacao" style="display:none;"></div>

<script>
    function mostrarNotificacao(mensagem) {
        const el = document.getElementById('notificacao');
        el.innerText = mensagem;
        el.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #6f00b5, #b500e0);
        color: white;
        padding: 12px 20px;
        border-radius: 12px;
        font-weight: bold;
        font-family: Arial, sans-serif;
        box-shadow: 0 0 10px rgba(0,0,0,0.5);
        z-index: 9999;
        opacity: 0;
        transition: opacity 0.4s ease-in-out;
    `;

        setTimeout(() => { el.style.opacity = 1; }, 10);
        setTimeout(() => {
            el.style.opacity = 0;
            setTimeout(() => el.style.display = "none", 500);
        }, 3000);
    }
        let formTemp = null;

        function confirmarExclusao(mensagem, formRef) {
            document.getElementById("confirmMessage").innerText = mensagem;
        formTemp = formRef;
        document.getElementById("confirmModal").style.display = "flex";
        return false;
        }

        function fecharModal() {
            document.getElementById("confirmModal").style.display = "none";
        formTemp = null;
        }

        function confirmarAcao() {
            if (formTemp) {
            formTemp.submit();
        fecharModal();
            }
        }

</script>

